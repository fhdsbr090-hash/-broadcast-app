<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø¨Ø« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  
  <div class="text-center mb-4">
    <h1 class="text-3xl font-bold mb-4">ğŸ¥ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø¨Ø« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h1>
    
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
    <div class="bg-gray-800 rounded-lg p-4 mb-4">
      <h2 class="text-xl mb-2">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØºØ±ÙØ©</h2>
      <div>
        <label class="block mb-2">Ø§Ø³Ù…Ùƒ:</label>
        <input id="username" type="text" class="bg-gray-700 px-3 py-2 rounded" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
      </div>
      <div class="mt-2">
        <label class="block mb-2">Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©:</label>
        <input id="roomId" type="text" class="bg-gray-700 px-3 py-2 rounded" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©">
      </div>
      <button id="joinRoom" class="bg-blue-600 px-4 py-2 rounded mt-2">ğŸšª Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©</button>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="space-x-2 rtl:space-x-reverse mb-4">
      <button id="startStream" class="bg-green-600 px-4 py-2 rounded">ğŸ¥ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«</button>
      <button id="stopStream" class="bg-red-600 px-4 py-2 rounded hidden">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«</button>
      <button id="toggleMic" class="bg-gray-600 px-4 py-2 rounded">ğŸ¤ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†</button>
      <button id="toggleCamera" class="bg-gray-600 px-4 py-2 rounded">ğŸ“· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    </div>
  </div>

  <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
    <div class="bg-gray-800 rounded-lg p-4">
      <h3 class="text-center mb-2">Ø£Ù†Øª</h3>
      <video id="localVideo" class="w-full rounded" autoplay muted></video>
    </div>
    <div id="remoteVideos" class="contents"></div>
  </div>

  <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
  <div class="bg-gray-800 rounded-lg p-4">
    <h3 class="text-xl mb-2">ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
    <div id="messages" class="h-32 overflow-y-auto bg-gray-700 rounded p-2 mb-2"></div>
    <div class="flex">
      <input id="messageInput" type="text" class="flex-1 bg-gray-700 px-3 py-2 rounded-r-none rounded-l" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
      <button id="sendMessage" class="bg-blue-600 px-4 py-2 rounded-l-none rounded-r">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </div>

  <script>
    // Ù…ØªØºÙŠØ±Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
    let localStream = null;
    let username = '';
    let roomId = '';
    let isConnected = false;
    let micEnabled = true;
    let cameraEnabled = true;
    let participants = new Map();

    // Ø¹Ù†Ø§ØµØ± DOM
    const localVideo = document.getElementById('localVideo');
    const remoteVideos = document.getElementById('remoteVideos');
    const messages = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');

    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù… Ø­Ù‚ÙŠÙ‚ÙŠ)
    const mockConnections = new Map();
    let currentRoom = null;

    // Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©
    document.getElementById('joinRoom').addEventListener('click', () => {
      username = document.getElementById('username').value.trim();
      roomId = document.getElementById('roomId').value.trim();
      
      if (!username || !roomId) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©');
        return;
      }

      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø§ØªØµØ§Ù„
      isConnected = true;
      currentRoom = roomId;
      
      addMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${username}! ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ© ${roomId}`);
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙˆÙ‡Ù…ÙŠÙŠÙ†
      setTimeout(() => {
        addParticipant('Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯');
        addMessage('Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¬Ù…ÙŠØ¹! ğŸ‘‹');
      }, 2000);
      
      setTimeout(() => {
        addParticipant('ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯');
        addMessage('ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯', 'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ğŸ˜Š');
      }, 4000);
    });

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«
    document.getElementById('startStream').addEventListener('click', async () => {
      if (!isConnected) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ© Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }

      try {
        localStream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: true
        });
        
        localVideo.srcObject = localStream;
        document.getElementById('startStream').classList.add('hidden');
        document.getElementById('stopStream').classList.remove('hidden');
        
        addMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `${username} Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ğŸ¥`);
        
      } catch (err) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ' + err.message);
      }
    });

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«
    document.getElementById('stopStream').addEventListener('click', () => {
      if (localStream) {
        localStream.getTracks().forEach(track => track.stop());
        localStream = null;
        localVideo.srcObject = null;
      }
      
      document.getElementById('startStream').classList.remove('hidden');
      document.getElementById('stopStream').classList.add('hidden');
      
      addMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `${username} Ø£ÙˆÙ‚Ù Ø§Ù„Ø¨Ø«`);
    });

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
    document.getElementById('toggleMic').addEventListener('click', () => {
      if (!localStream) return;
      
      micEnabled = !micEnabled;
      localStream.getAudioTracks().forEach(track => track.enabled = micEnabled);
      
      const btn = document.getElementById('toggleMic');
      btn.textContent = micEnabled ? 'ğŸ¤ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†' : 'ğŸ”‡ Ù…ÙƒØªÙˆÙ…';
      btn.className = micEnabled ? 'bg-gray-600 px-4 py-2 rounded' : 'bg-red-600 px-4 py-2 rounded';
      
      addMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `${username} ${micEnabled ? 'ÙØªØ­' : 'Ø£ØºÙ„Ù‚'} Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†`);
    });

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    document.getElementById('toggleCamera').addEventListener('click', () => {
      if (!localStream) return;
      
      cameraEnabled = !cameraEnabled;
      localStream.getVideoTracks().forEach(track => track.enabled = cameraEnabled);
      
      const btn = document.getElementById('toggleCamera');
      btn.textContent = cameraEnabled ? 'ğŸ“· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§' : 'ğŸ“· Ù…ØªÙˆÙ‚ÙØ©';
      btn.className = cameraEnabled ? 'bg-gray-600 px-4 py-2 rounded' : 'bg-red-600 px-4 py-2 rounded';
      
      addMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `${username} ${cameraEnabled ? 'ÙØªØ­' : 'Ø£ØºÙ„Ù‚'} Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§`);
    });

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    document.getElementById('sendMessage').addEventListener('click', () => {
      const message = messageInput.value.trim();
      if (message && username) {
        addMessage(username, message);
        messageInput.value = '';
        
        // Ø±Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
        setTimeout(() => {
          const responses = [
            'Ø±Ø§Ø¦Ø¹! ğŸ‘',
            'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ',
            'Ø£ÙˆØ§ÙÙ‚Ùƒ Ø§Ù„Ø±Ø£ÙŠ',
            'Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…ÙÙŠØ¯Ø©',
            'Ù…Ù…ØªØ§Ø²!'
          ];
          const randomResponse = responses[Math.floor(Math.random() * responses.length)];
          const participants = ['Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', 'ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯'];
          const randomParticipant = participants[Math.floor(Math.random() * participants.length)];
          addMessage(randomParticipant, randomResponse);
        }, 1000 + Math.random() * 2000);
      }
    });

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±Ùƒ ÙˆÙ‡Ù…ÙŠ
    function addParticipant(name) {
      const participantDiv = document.createElement('div');
      participantDiv.className = 'bg-gray-800 rounded-lg p-4';
      participantDiv.innerHTML = `
        <h3 class="text-center mb-2">${name}</h3>
        <div class="w-full h-32 bg-gradient-to-r from-blue-500 to-purple-500 rounded flex items-center justify-center text-white font-bold">
          ğŸ“¹ ${name}
        </div>
      `;
      remoteVideos.appendChild(participantDiv);
      participants.set(name, participantDiv);
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
    function addMessage(sender, text) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'mb-2 p-2 bg-gray-600 rounded';
      messageDiv.innerHTML = `<strong class="text-blue-400">${sender}:</strong> ${text}`;
      messages.appendChild(messageDiv);
      messages.scrollTop = messages.scrollHeight;
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('sendMessage').click();
      }
    });
  </script>
</body>
</html>
